{% extends "_base.html" %} {% load static %} {% block content %}

<!-- Being dumb. we need to do an ajax call to the django model, not connect to a pg database -->
<!-- https://www.geeksforgeeks.org/handling-ajax-request-in-django/ -->
<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="{% static '/js/census-advancedanalysis.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Reload previous selections from sessions storage -->
    <!-- <script type="text/javascript">
      window.onload = function () {

        // Tract-Blockgroup, independent variable value, year, and state
        var selItem = sessionStorage.getItem("tr_bg_key");
        $("#tr_bg").val(selItem);
        var selItem = sessionStorage.getItem("ind_var_val_key");
        $("#ind_var_val").val(selItem);
        var selItem = sessionStorage.getItem("year_key");
        $("#year").val(selItem);
        var selItem = sessionStorage.getItem("state_key");
        $("#state").val(selItem);

        // Load table selections
        var tab_ind = sessionStorage.getItem("table_ind_key");
        var tab_dep = sessionStorage.getItem("table_dep_key");
        if (sessionStorage.getItem("tr_bg_key") !== null && sessionStorage.getItem("tr_bg_key") !=='') {
          populate_tables("tr_bg","table_ind","table_dep","cat_ind","cat_dep","var_ind","var_dep");

          // Independent Variable
          if (tab_ind !== null && tab_ind !== '') {
            $("#table_ind").val(tab_ind);

            // Load category selection
            var s2 = document.getElementById("cat_ind");
            var cats = sessionStorage.getItem("cat_ind_key_list");
            var cats_array = cats.split('`');
            var newOption = document.createElement('option');
            newOption.value = '';
            newOption.innerHTML = 'Select a category...';
            s2.options.add(newOption);
            for (i in cats_array){
              var newOption = document.createElement('option');
              newOption.value = cats_array[i];
              newOption.innerHTML = cats_array[i];
              s2.options.add(newOption);
            };

            // Load variable selection
            var cat_val = sessionStorage.getItem("cat_ind_key")
            if (cat_val !== null && cat_val !== '') {
              $("#cat_ind").val(cat_val);

              var s2 = document.getElementById("var_ind");
              var vars = sessionStorage.getItem("var_ind_key_list");
              var vars_array = vars.split('`');
              var vars_html = sessionStorage.getItem("var_ind_key_list_html");
              var vars_html_array = vars_html.split('`');
              var newOption = document.createElement('option');
              newOption.value = '';
              newOption.innerHTML = 'Select a variable...';
              s2.options.add(newOption);
              for (i in vars_array){
                var newOption = document.createElement('option');
                newOption.value = vars_array[i] + ":" + vars_html_array[i];
                newOption.innerHTML = vars_html_array[i];
                s2.options.add(newOption);
              };
            }

            else {
              sessionStorage.removeItem('var_ind_key')
              sessionStorage.removeItem('var_ind_key_html')
              sessionStorage.removeItem('var_ind_key_list')
              sessionStorage.removeItem('var_ind_key_list_html')
            }

            var var_ind = sessionStorage.getItem("var_ind_key");
            if (var_ind !== null) {
              $("#var_ind").val(var_ind);
            }
          }


          //Dependent Variable
          if (tab_dep !== null && tab_dep !== '') {
            $("#table_dep").val(tab_dep);

            // Load category selection
            var s2 = document.getElementById("cat_dep");
            var cats = sessionStorage.getItem("cat_dep_key_list");
            var cats_array = cats.split('`');
            var newOption = document.createElement('option');
            newOption.value = '';
            newOption.innerHTML = 'Select a category...';
            s2.options.add(newOption);
            for (i in cats_array){
              var newOption = document.createElement('option');
              newOption.value = cats_array[i];
              newOption.innerHTML = cats_array[i];
              s2.options.add(newOption);
            };

            // Load variable selection
            var cat_val = sessionStorage.getItem("cat_dep_key")
            if (cat_val !== null && cat_val !== '') {
              $("#cat_dep").val(cat_val);

              var s2 = document.getElementById("var_dep");
              var vars = sessionStorage.getItem("var_dep_key_list");
              var vars_array = vars.split('`');
              var vars_html = sessionStorage.getItem("var_dep_key_list_html");
              var vars_html_array = vars_html.split('`');
              var newOption = document.createElement('option');
              newOption.value = '';
              newOption.innerHTML = 'Select a variable...';
              s2.options.add(newOption);
              for (i in vars_array){
                var newOption = document.createElement('option');
                newOption.value = vars_array[i] + ":" + vars_html_array[i];
                newOption.innerHTML = vars_html_array[i];
                s2.options.add(newOption);
              };
            }

            else {
              sessionStorage.removeItem('var_dep_key')
              sessionStorage.removeItem('var_dep_key_html')
              sessionStorage.removeItem('var_dep_key_list')
              sessionStorage.removeItem('var_dep_key_list_html')
            }

            var var_dep = sessionStorage.getItem("var_dep_key");
            if (var_dep !== null) {
              $("#var_dep").val(var_dep);
            }
          }
        }

        else {
          sessionStorage.removeItem('table_ind_key')
          sessionStorage.removeItem('table_dep_key')
          sessionStorage.removeItem('cat_ind_key')
          sessionStorage.removeItem('cat_ind_key_list')
          sessionStorage.removeItem('cat_dep_key')
          sessionStorage.removeItem('cat_dep_key_list')
          sessionStorage.removeItem('var_ind_key')
          sessionStorage.removeItem('var_ind_key_html')
          sessionStorage.removeItem('var_ind_key_list')
          sessionStorage.removeItem('var_ind_key_list_html')
          sessionStorage.removeItem('var_dep_key')
          sessionStorage.removeItem('var_dep_key_html')
          sessionStorage.removeItem('var_dep_key_list')
          sessionStorage.removeItem('var_dep_key_list_html')

        }
      };
    </script> -->

    <style>
      /* Hide contextual divs */
      #cols_div {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="row align-items-top my-5">
        <div class="col-xs-12 col-sm-12 col-md-6">
          <p></p>
          <h2 class="font-weight-light">Census Data App</h2>
          This application parses and analyzes data from the US Census Bureau
          website.
          <p></p>
          <h4 class="font-weight-light">Module 3. Advanced Statistical Analysis</h4>
          
          <i>Tract or Block Group</i>
            {% csrf_token %}

            <!-- Select Tract of Block Group -->
            <select name="tr_bg" id="tr_bg" class="form-select form-select-sm" onchange="populate_tables(this.id,'table_ind','col_ind','table_dep','col_dep')">
              <option value="none">Select an option...</option>
              <option value="tract">Tract</option>
              <option value="blockgroup">Block Group</option>
            </select>
            <p></p>

            <li>Independent Variable</li>
            <!-- Select independent table -->
            <select name="table_ind" id="table_ind" class="form-select form-select-sm" onchange="populate_col(this.id,'col_ind',{{ cols }})">
            </select>
            <p></p>

            <!-- Select independent column -->
            <select name="col_ind" id='col_ind' class="form-select form-select-sm">
            </select>
            <p></p>


          <li>Dependent Variable</li>
            <!-- Select dependent table -->
            <select name="table_dep" id="table_dep" class="form-select form-select-sm" onchange="populate_col(this.id,'col_dep',{{ cols }})">
            </select>
            <p></p>

            <!-- Select dependent column -->
            <select name="col_dep" id='col_dep' class="form-select form-select-sm">
            </select>
            <p></p>
          </li>
        </div>
      </div>
    </div>
  </body>

</html>

{% endblock content %}
