{% extends "_base.html" %} {% load static %} {% block content %}
<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="{% static '/js/census-advancedanalysis.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Reload previous selections from sessions storage -->
    <script type="text/javascript">
      window.onload = function () {

        // Tract-Blockgroup, independent variable value, year, and state
        var selItem = sessionStorage.getItem("tr_bg_key");
        $("#tr_bg").val(selItem);
        var selItem = sessionStorage.getItem("ind_var_val_key");
        $("#ind_var_val").val(selItem);
        var selItem = sessionStorage.getItem("year_key");
        $("#year").val(selItem);
        var selItem = sessionStorage.getItem("state_key");
        $("#state").val(selItem);

        // Load table selections
        var tab_ind = sessionStorage.getItem("table_ind_key");
        var tab_dep = sessionStorage.getItem("table_dep_key");
        if (sessionStorage.getItem("tr_bg_key") !== null && sessionStorage.getItem("tr_bg_key") !=='') {
          populate_tables("tr_bg","table_ind","table_dep","cat_ind","cat_dep","var_ind","var_dep");

          // Independent Variable
          if (tab_ind !== null && tab_ind !== '') {
            $("#table_ind").val(tab_ind);

            // Load category selection
            var s2 = document.getElementById("cat_ind");
            var cats = sessionStorage.getItem("cat_ind_key_list");
            var cats_array = cats.split('`');
            var newOption = document.createElement('option');
            newOption.value = '';
            newOption.innerHTML = 'Select a category...';
            s2.options.add(newOption);
            for (i in cats_array){
              var newOption = document.createElement('option');
              newOption.value = cats_array[i];
              newOption.innerHTML = cats_array[i];
              s2.options.add(newOption);
            };

            // Load variable selection
            var cat_val = sessionStorage.getItem("cat_ind_key")
            if (cat_val !== null && cat_val !== '') {
              $("#cat_ind").val(cat_val);

              var s2 = document.getElementById("var_ind");
              var vars = sessionStorage.getItem("var_ind_key_list");
              var vars_array = vars.split('`');
              var vars_html = sessionStorage.getItem("var_ind_key_list_html");
              var vars_html_array = vars_html.split('`');
              var newOption = document.createElement('option');
              newOption.value = '';
              newOption.innerHTML = 'Select a variable...';
              s2.options.add(newOption);
              for (i in vars_array){
                var newOption = document.createElement('option');
                newOption.value = vars_array[i] + ":" + vars_html_array[i];
                newOption.innerHTML = vars_html_array[i];
                s2.options.add(newOption);
              };
            }

            else {
              sessionStorage.removeItem('var_ind_key')
              sessionStorage.removeItem('var_ind_key_html')
              sessionStorage.removeItem('var_ind_key_list')
              sessionStorage.removeItem('var_ind_key_list_html')
            }

            var var_ind = sessionStorage.getItem("var_ind_key");
            if (var_ind !== null) {
              $("#var_ind").val(var_ind);
            }
          }


          //Dependent Variable
          if (tab_dep !== null && tab_dep !== '') {
            $("#table_dep").val(tab_dep);

            // Load category selection
            var s2 = document.getElementById("cat_dep");
            var cats = sessionStorage.getItem("cat_dep_key_list");
            var cats_array = cats.split('`');
            var newOption = document.createElement('option');
            newOption.value = '';
            newOption.innerHTML = 'Select a category...';
            s2.options.add(newOption);
            for (i in cats_array){
              var newOption = document.createElement('option');
              newOption.value = cats_array[i];
              newOption.innerHTML = cats_array[i];
              s2.options.add(newOption);
            };

            // Load variable selection
            var cat_val = sessionStorage.getItem("cat_dep_key")
            if (cat_val !== null && cat_val !== '') {
              $("#cat_dep").val(cat_val);

              var s2 = document.getElementById("var_dep");
              var vars = sessionStorage.getItem("var_dep_key_list");
              var vars_array = vars.split('`');
              var vars_html = sessionStorage.getItem("var_dep_key_list_html");
              var vars_html_array = vars_html.split('`');
              var newOption = document.createElement('option');
              newOption.value = '';
              newOption.innerHTML = 'Select a variable...';
              s2.options.add(newOption);
              for (i in vars_array){
                var newOption = document.createElement('option');
                newOption.value = vars_array[i] + ":" + vars_html_array[i];
                newOption.innerHTML = vars_html_array[i];
                s2.options.add(newOption);
              };
            }

            else {
              sessionStorage.removeItem('var_dep_key')
              sessionStorage.removeItem('var_dep_key_html')
              sessionStorage.removeItem('var_dep_key_list')
              sessionStorage.removeItem('var_dep_key_list_html')
            }

            var var_dep = sessionStorage.getItem("var_dep_key");
            if (var_dep !== null) {
              $("#var_dep").val(var_dep);
            }
          }
        }

        else {
          sessionStorage.removeItem('table_ind_key')
          sessionStorage.removeItem('table_dep_key')
          sessionStorage.removeItem('cat_ind_key')
          sessionStorage.removeItem('cat_ind_key_list')
          sessionStorage.removeItem('cat_dep_key')
          sessionStorage.removeItem('cat_dep_key_list')
          sessionStorage.removeItem('var_ind_key')
          sessionStorage.removeItem('var_ind_key_html')
          sessionStorage.removeItem('var_ind_key_list')
          sessionStorage.removeItem('var_ind_key_list_html')
          sessionStorage.removeItem('var_dep_key')
          sessionStorage.removeItem('var_dep_key_html')
          sessionStorage.removeItem('var_dep_key_list')
          sessionStorage.removeItem('var_dep_key_list_html')

        }
      };
    </script>

    <style>
      /* Hide contextual divs */
      #cols_div {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="row align-items-top my-5">
        <div class="col-xs-12 col-sm-12 col-md-6">
          <p></p>
          <h2 class="font-weight-light">Census Data App</h2>
          This application parses and analyzes data from the US Census Bureau
          website.
          <p></p>

          <h4 class="font-weight-light">Module 3. Advanced Statistical Analysis</h4>
          <li>Tract</li>
          <form method="POST" enctype="multipart/form-data" class="form-inline">
            {% csrf_token %}
            <select class="form-select form-select-sm" name="tr_bg" id="tr_bg"
            onchange="populate_tables(this.id,'table_ind','table_dep','cat_ind','cat_dep','var_ind','var_dep')"
            required="required" style="width: 325px;">
              <option value="">Select the tract option...</option>
              <option value="Tract" selected>Tract</option>
            </select>
            <p></p>

            <li>Independent Variable</li>
            Table:
            <select class="form-select form-select-sm" name="table_ind" id="table_ind"
            onchange="populate_cat(this.id,'cat_ind','var_ind')"
            required="required">
            </select>

            <p></p>

            Category:
            <select
              class="form-select form-select-sm"
              name="cat_ind"
              id="cat_ind"
              onchange="populate_var(this.id,'var_ind','table_ind')"
              required="required"
            ></select>

            <p></p>
            Variable:
            <select
              class="form-select form-select-sm"
              name="var_ind"
              id="var_ind"
              onchange="set_session_var(this.id)"
              required="required"
            ></select>
            <p></p>

            <li>Dependent Variable</li>
            Table:
            <select
              class="form-select form-select-sm"
              name="table_dep"
              id="table_dep"
              onchange="populate_cat(this.id,'cat_dep','var_dep')"
              required="required"
            ></select>
            <p></p>

            Category:
            <select
              class="form-select form-select-sm"
              name="cat_dep"
              id="cat_dep"
              onchange="populate_var(this.id,'var_dep','table_dep')"
              required="required"
            ></select>
            <p></p>

            Variable:
            <select
              class="form-select form-select-sm"
              name="var_dep"
              id="var_dep"
              onchange="set_session_var(this.id)"
              required="required"
            ></select>
            <p></p>

            <li>Enter the independent variable value (%)</li>
            <div class="input-group input-group-sm mb-3" style="width: 200px">
              <span class="input-group-text" id="inputGroup-sizing-sm">%</span>
              <input type="number" class="form-control" aria-label="Sizing example input"
              aria-describedby="inputGroup-sizing-sm"
              id="ind_var_val" name="ind_var_val" min="0" max="100"
              onchange="set_session_var_indval(this.id)" required="required">
            </div>
            <p></p>

            <li>Select the year and state</li>
            <div class="row">
              <div class="col-xs-6 col-sm-6 col-md-3">
                <select
                  class="form-select form-select-sm"
                  name="year"
                  id="year"
                  onchange="set_session_var(this.id)"
                  required="required">
                  <option value="">Select a year...</option>
                  <option value="2010">2010</option>
                  <option value="2011">2011</option>
                  <option value="2012">2012</option>
                  <option value="2013">2013</option>
                  <option value="2014">2014</option>
                  <option value="2015">2015</option>
                  <option value="2016">2016</option>
                  <option value="2017">2017</option>
                  <option value="2018">2018</option>
                  <option value="2019">2019</option>
                </select>
              </div>
              <div class="col-xs-6 col-sm-6 col-md-3">
                <select
                  class="form-select form-select-sm"
                  name="state"
                  id="state"
                  onchange="set_session_var(this.id)"
                  required="required">
                <option value="">Select a state...</option>
                <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <option value="AR">Arkansas</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DE">Delaware</option>
                <option value="DC">District Of Columbia</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="IA">Iowa</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="ME">Maine</option>
                <option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MS">Mississippi</option>
                <option value="MO">Missouri</option>
                <option value="MT">Montana</option>
                <option value="NE">Nebraska</option>
                <option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NY">New York</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VT">Vermont</option>
                <option value="VA">Virginia</option>
                <option value="WA">Washington</option>
                <option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option>
                <option value="WY">Wyoming</option>
                </select>
              </div>
            </div>
            <p></p>

            <button class="btn btn-primary" type="submit">Submit</button>
          </form>
          <p></p>
            For questions, comments, or suggestions for improvement on the apps,
            please email Sam Klump at
            <a href="mailto:sam.klump@outlook.com">sam.klump@outlook.com</a>.
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6">
          <div class="row">
            <div style="width:700px;height:600px">
              {% autoescape off %}
              {{ plot_div }}
              {% endautoescape %}
            </div>
          </div>
          <div class="row">
            <div class="col-1"></div>
            <div class="col-11">
              <div>
                <u>Input value:</u>  {{ input_val }}% "{{input_var}}"<br>
                <u>Predicted value:</u>  {{ pred_val }}% "{{pred_var}}""
              </div>
            </div>
          </div>
          <p></p>
          <div class="row">
            <div class="col-1"></div>
            <div class="col-11">
              <div>
                <small>{{ model_results }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

</html>

{% endblock content %}
